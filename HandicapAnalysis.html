<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golf Handicap Audit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
        }

        .negative-adj {
            color: #dc2626;
            font-weight: bold;
        }

        .neutral-adj {
            color: #059669;
        }

        .active-mode {
            background-color: #059669;
            color: white;
            border-color: #059669;
        }

        .inactive-mode {
            background-color: white;
            color: #4b5563;
            border-color: #e5e7eb;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-800">

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <!-- Header -->
        <div class="mb-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div class="flex items-center gap-3">
                <img src="SG-SG Map.png" alt="SG-SG Map" class="h-10 w-10 object-contain">
                <div>
                    <h1 class="text-3xl font-bold text-slate-900 flex items-center gap-2">
                        <span>SG@SG</span>
                        <span class="text-emerald-600">Handicap Audit</span>
                    </h1>
                    <p class="text-slate-500 mt-1">Implied Index vs. Current Index Analysis</p>
                </div>
            </div>

            <div class="flex flex-col sm:flex-row gap-4 items-center">
                <!-- Mode Toggle -->
                <div class="flex rounded-md shadow-sm" role="group">
                    <button type="button" onclick="setMode('best3')" id="btn-best3"
                        class="px-4 py-2 text-sm font-medium border rounded-l-lg active-mode transition-colors">
                        Best 3 Analysis
                    </button>
                    <button type="button" onclick="setMode('best6')" id="btn-best6"
                        class="px-4 py-2 text-sm font-medium border rounded-r-lg inactive-mode transition-colors">
                        Best 6 Analysis
                    </button>
                </div>

                <div class="flex gap-2">
                    <div class="bg-white px-4 py-2 rounded-lg shadow-sm border border-slate-200 text-center">
                        <span class="text-xs text-slate-500 uppercase font-semibold block">Players</span>
                        <span class="text-xl font-bold" id="totalPlayers">0</span>
                    </div>
                    <div class="bg-white px-4 py-2 rounded-lg shadow-sm border border-slate-200 text-center">
                        <span class="text-xs text-slate-500 uppercase font-semibold block">Avg Gross</span>
                        <span class="text-xl font-bold" id="groupAvgGross">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Top Alerts (Top 3 Adjustments) -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <!-- Rank 1 -->
            <div
                class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 border-l-4 border-red-600 relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10"><i class="fa-solid fa-trophy text-6xl"></i></div>
                <h3 class="text-sm font-semibold text-slate-500 uppercase mb-2">#1 Adjustment</h3>
                <div class="text-2xl font-bold text-slate-800 truncate" id="rank1Name">--</div>
                <div class="flex items-baseline gap-2 mt-1">
                    <span class="text-red-600 font-bold text-2xl" id="rank1Val">--</span>
                    <span class="text-sm text-slate-400">suggested</span>
                </div>
                <div class="mt-2 text-xs text-slate-500 bg-slate-100 inline-block px-2 py-1 rounded" id="rank1Rounds">--
                    rounds</div>
            </div>

            <!-- Rank 2 -->
            <div
                class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 border-l-4 border-orange-500 relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10"><i class="fa-solid fa-medal text-6xl"></i></div>
                <h3 class="text-sm font-semibold text-slate-500 uppercase mb-2">#2 Adjustment</h3>
                <div class="text-2xl font-bold text-slate-800 truncate" id="rank2Name">--</div>
                <div class="flex items-baseline gap-2 mt-1">
                    <span class="text-orange-600 font-bold text-2xl" id="rank2Val">--</span>
                    <span class="text-sm text-slate-400">suggested</span>
                </div>
                <div class="mt-2 text-xs text-slate-500 bg-slate-100 inline-block px-2 py-1 rounded" id="rank2Rounds">--
                    rounds</div>
            </div>

            <!-- Rank 3 -->
            <div
                class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 border-l-4 border-yellow-500 relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10"><i class="fa-solid fa-medal text-6xl"></i></div>
                <h3 class="text-sm font-semibold text-slate-500 uppercase mb-2">#3 Adjustment</h3>
                <div class="text-2xl font-bold text-slate-800 truncate" id="rank3Name">--</div>
                <div class="flex items-baseline gap-2 mt-1">
                    <span class="text-yellow-600 font-bold text-2xl" id="rank3Val">--</span>
                    <span class="text-sm text-slate-400">suggested</span>
                </div>
                <div class="mt-2 text-xs text-slate-500 bg-slate-100 inline-block px-2 py-1 rounded" id="rank3Rounds">--
                    rounds</div>
            </div>
        </div>

        <!-- Filters & Search -->
        <div
            class="bg-white rounded-t-xl border border-slate-200 p-4 flex flex-col sm:flex-row justify-between items-center gap-4">
            <div class="relative w-full sm:w-64">
                <i class="fa-solid fa-search absolute left-3 top-3 text-slate-400"></i>
                <input type="text" id="searchInput" placeholder="Search player..."
                    class="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500">
            </div>
            <div class="flex gap-2">
                <button onclick="filterRounds(0)"
                    class="filter-btn px-3 py-1 text-sm rounded-full bg-slate-100 hover:bg-slate-200 active-filter"
                    data-min="0">All Rounds</button>
                <button onclick="filterRounds(3)"
                    class="filter-btn px-3 py-1 text-sm rounded-full bg-slate-100 hover:bg-slate-200" data-min="3">3+
                    Rounds</button>
                <button onclick="filterRounds(5)"
                    class="filter-btn px-3 py-1 text-sm rounded-full bg-slate-100 hover:bg-slate-200" data-min="5">5+
                    Rounds</button>
            </div>
        </div>

        <!-- Table -->
        <div class="bg-white border-x border-b border-slate-200 rounded-b-xl overflow-hidden shadow-sm">
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr
                            class="bg-slate-50 text-slate-600 text-xs uppercase tracking-wider border-b border-slate-200">
                            <th class="p-4 cursor-pointer hover:bg-slate-100" onclick="sortTable('name')">Player <i
                                    class="fa-solid fa-sort ml-1"></i></th>
                            <th class="p-4 text-center cursor-pointer hover:bg-slate-100"
                                onclick="sortTable('implied')">Implied Index <i class="fa-solid fa-sort ml-1"></i></th>
                            <th class="p-4 text-center cursor-pointer hover:bg-slate-100"
                                onclick="sortTable('current')">Current Index <i class="fa-solid fa-sort ml-1"></i></th>
                            <th class="p-4 text-center cursor-pointer hover:bg-slate-100"
                                onclick="sortTable('adjustment')">Suggested Adj <i class="fa-solid fa-sort ml-1"></i>
                            </th>
                            <th class="p-4 text-center cursor-pointer hover:bg-slate-100"
                                onclick="sortTable('avgGross')">Avg Gross <i class="fa-solid fa-sort ml-1"></i></th>
                            <th class="p-4 text-center cursor-pointer hover:bg-slate-100" onclick="sortTable('avgNet')">
                                Avg Net <i class="fa-solid fa-sort ml-1"></i></th>
                            <th class="p-4 text-center cursor-pointer hover:bg-slate-100" onclick="sortTable('rounds')">
                                Rounds <i class="fa-solid fa-sort ml-1"></i></th>
                            <th class="p-4">Notes</th>
                        </tr>
                    </thead>
                    <tbody id="statsTableBody" class="text-sm text-slate-700 divide-y divide-slate-100">
                        <!-- Rows generated by JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const dataBest3 = [
    {
        "x": "Andrew Burnheimer",
        "y": 11.4
    },
    {
        "x": "Andy Meach",
        "y": 8.7
    },
    {
        "x": "Ben Magnone",
        "y": 7.7
    },
    {
        "x": "Brad Ackley",
        "y": 19.6
    },
    {
        "x": "Brian Howell",
        "y": 10.1
    },
    {
        "x": "Bud Scott",
        "y": 15.5
    },
    {
        "x": "Buddy Goldstone",
        "y": 19.0
    },
    {
        "x": "Chris Beck",
        "y": 13.2
    },
    {
        "x": "Chris Husong",
        "y": 12.3
    },
    {
        "x": "Chris Ryan",
        "y": 17.8
    },
    {
        "x": "Christopher Royce",
        "y": 14.7
    },
    {
        "x": "Clark Koch",
        "y": 7.4
    },
    {
        "x": "Conrad Copeland",
        "y": 18.7
    },
    {
        "x": "Dan Denham",
        "y": 8.4
    },
    {
        "x": "Dana Beckley",
        "y": 17.8
    },
    {
        "x": "Darrin Harn",
        "y": 5.9
    },
    {
        "x": "David Edwards",
        "y": 10.1
    },
    {
        "x": "David Pearson",
        "y": 11.4
    },
    {
        "x": "Dean Fisk",
        "y": 13.8
    },
    {
        "x": "Derek Becko",
        "y": 5.3
    },
    {
        "x": "Dusty Wasmund",
        "y": 8.4
    },
    {
        "x": "Eric Lamb",
        "y": 23.2
    },
    {
        "x": "Eric Weiss",
        "y": -0.1
    },
    {
        "x": "Frank Angeloro",
        "y": 6.8
    },
    {
        "x": "Glenn Brand",
        "y": 23.2
    },
    {
        "x": "Greg Funk",
        "y": 3.2
    },
    {
        "x": "Hans Anderson",
        "y": 2.9
    },
    {
        "x": "James Feutz",
        "y": 1.4
    },
    {
        "x": "Jamey Davis",
        "y": 13.5
    },
    {
        "x": "Jared Strathe",
        "y": -1.1
    },
    {
        "x": "Jeff Avery",
        "y": 14.7
    },
    {
        "x": "Jeff Cloepfil",
        "y": 11.1
    },
    {
        "x": "Jeff De Laveaga",
        "y": -0.5
    },
    {
        "x": "Jim Brown",
        "y": 6.8
    },
    {
        "x": "Jim Restivo",
        "y": 15.0
    },
    {
        "x": "Joe Sepessy",
        "y": 3.8
    },
    {
        "x": "Jon Vrolyks",
        "y": 8.4
    },
    {
        "x": "Justin Deuker",
        "y": 5.9
    },
    {
        "x": "Kevin Barber",
        "y": 12.6
    },
    {
        "x": "Kevin Mueller",
        "y": 16.9
    },
    {
        "x": "Kiernan Mattson",
        "y": 0.2
    },
    {
        "x": "Korey Jerome",
        "y": 8.7
    },
    {
        "x": "Larry Caplan",
        "y": 17.2
    },
    {
        "x": "Mark Albedyll",
        "y": 18.1
    },
    {
        "x": "Mark James",
        "y": 17.8
    },
    {
        "x": "Mark Lewis",
        "y": 10.8
    },
    {
        "x": "Matt Neimeier",
        "y": 11.1
    },
    {
        "x": "Michael Falagrady",
        "y": 9.9
    },
    {
        "x": "Mike Muller",
        "y": 5.3
    },
    {
        "x": "Mike Wilkins",
        "y": 14.1
    },
    {
        "x": "Nate Adams",
        "y": -5.0
    },
    {
        "x": "Neil Harris",
        "y": -2.3
    },
    {
        "x": "Pat Feutz",
        "y": 5.9
    },
    {
        "x": "Patrick Schueppert",
        "y": 17.2
    },
    {
        "x": "Paul Benga",
        "y": 4.1
    },
    {
        "x": "Rich Fagan",
        "y": 15.3
    },
    {
        "x": "Rich Mckeon",
        "y": 14.1
    },
    {
        "x": "Richard Lederman",
        "y": 14.1
    },
    {
        "x": "Rick Deloney",
        "y": 9.0
    },
    {
        "x": "Rick Meewes",
        "y": 8.7
    },
    {
        "x": "Rob Oliver",
        "y": 16.3
    },
    {
        "x": "Robert Hill",
        "y": 21.4
    },
    {
        "x": "Ron Amstutz",
        "y": 11.1
    },
    {
        "x": "Ron Marino",
        "y": 7.4
    },
    {
        "x": "Scott Benton",
        "y": 11.4
    },
    {
        "x": "Scott Bracken",
        "y": 8.4
    },
    {
        "x": "Scott Lucas",
        "y": 11.4
    },
    {
        "x": "Shane Bolosan",
        "y": 7.2
    },
    {
        "x": "Shawn Warner",
        "y": 15.9
    },
    {
        "x": "Stephen Cherepy",
        "y": 15.0
    },
    {
        "x": "Steve Mccormick",
        "y": 9.9
    },
    {
        "x": "Steve Rosenbluth",
        "y": 12.6
    },
    {
        "x": "Stewart Polakov",
        "y": 3.2
    },
    {
        "x": "Thomas Earl",
        "y": 11.4
    },
    {
        "x": "Todd Densley",
        "y": 0.5
    },
    {
        "x": "Tracy Copenhaver",
        "y": 16.6
    },
    {
        "x": "Travis Ingram",
        "y": 7.1
    },
    {
        "x": "Travis Jorgensen",
        "y": 12.3
    },
    {
        "x": "Trent Dana",
        "y": 15.9
    },
    {
        "x": "Win Doolittle",
        "y": 17.8
    },
    {
        "x": "Zach Coe",
        "y": 1.4
    },
    {
        "x": "Zach Fleishman",
        "y": 14.4
    },
    {
        "x": "Zach Mattson",
        "y": 12.3
    },
    {
        "x": "Zane Eisenbarth",
        "y": 7.7
    }
];

        const dataBest6 = [
    {
        "x": "Andrew Burnheimer",
        "y": 11.4
    },
    {
        "x": "Andy Meach",
        "y": 10.0
    },
    {
        "x": "Ben Magnone",
        "y": 10.0
    },
    {
        "x": "Brad Ackley",
        "y": 19.6
    },
    {
        "x": "Brian Howell",
        "y": 10.1
    },
    {
        "x": "Bud Scott",
        "y": 15.5
    },
    {
        "x": "Buddy Goldstone",
        "y": 19.0
    },
    {
        "x": "Chris Beck",
        "y": 14.6
    },
    {
        "x": "Chris Husong",
        "y": 14.0
    },
    {
        "x": "Chris Ryan",
        "y": 19.9
    },
    {
        "x": "Christopher Royce",
        "y": 15.9
    },
    {
        "x": "Clark Koch",
        "y": 9.3
    },
    {
        "x": "Conrad Copeland",
        "y": 18.7
    },
    {
        "x": "Dan Denham",
        "y": 8.4
    },
    {
        "x": "Dana Beckley",
        "y": 17.8
    },
    {
        "x": "Darrin Harn",
        "y": 5.9
    },
    {
        "x": "David Edwards",
        "y": 10.1
    },
    {
        "x": "David Pearson",
        "y": 11.4
    },
    {
        "x": "Dean Fisk",
        "y": 13.8
    },
    {
        "x": "Derek Becko",
        "y": 6.7
    },
    {
        "x": "Dusty Wasmund",
        "y": 9.4
    },
    {
        "x": "Eric Lamb",
        "y": 23.2
    },
    {
        "x": "Eric Weiss",
        "y": 0.8
    },
    {
        "x": "Frank Angeloro",
        "y": 8.4
    },
    {
        "x": "Glenn Brand",
        "y": 23.2
    },
    {
        "x": "Greg Funk",
        "y": 4.7
    },
    {
        "x": "Hans Anderson",
        "y": 2.9
    },
    {
        "x": "James Feutz",
        "y": 1.4
    },
    {
        "x": "Jamey Davis",
        "y": 13.5
    },
    {
        "x": "Jared Strathe",
        "y": -1.1
    },
    {
        "x": "Jeff Avery",
        "y": 14.7
    },
    {
        "x": "Jeff Cloepfil",
        "y": 12.3
    },
    {
        "x": "Jeff De Laveaga",
        "y": -0.5
    },
    {
        "x": "Jim Brown",
        "y": 6.8
    },
    {
        "x": "Jim Restivo",
        "y": 16.6
    },
    {
        "x": "Joe Sepessy",
        "y": 6.5
    },
    {
        "x": "Jon Vrolyks",
        "y": 9.9
    },
    {
        "x": "Justin Deuker",
        "y": 7.0
    },
    {
        "x": "Kevin Barber",
        "y": 15.0
    },
    {
        "x": "Kevin Mueller",
        "y": 16.9
    },
    {
        "x": "Kiernan Mattson",
        "y": 3.6
    },
    {
        "x": "Korey Jerome",
        "y": 10.0
    },
    {
        "x": "Larry Caplan",
        "y": 21.2
    },
    {
        "x": "Mark Albedyll",
        "y": 20.3
    },
    {
        "x": "Mark James",
        "y": 17.8
    },
    {
        "x": "Mark Lewis",
        "y": 13.2
    },
    {
        "x": "Matt Neimeier",
        "y": 12.2
    },
    {
        "x": "Michael Falagrady",
        "y": 9.9
    },
    {
        "x": "Mike Muller",
        "y": 7.6
    },
    {
        "x": "Mike Wilkins",
        "y": 14.1
    },
    {
        "x": "Nate Adams",
        "y": -5.0
    },
    {
        "x": "Neil Harris",
        "y": -1.8
    },
    {
        "x": "Pat Feutz",
        "y": 5.9
    },
    {
        "x": "Patrick Schueppert",
        "y": 19.0
    },
    {
        "x": "Paul Benga",
        "y": 5.0
    },
    {
        "x": "Rich Fagan",
        "y": 18.5
    },
    {
        "x": "Rich Mckeon",
        "y": 14.1
    },
    {
        "x": "Richard Lederman",
        "y": 15.6
    },
    {
        "x": "Rick Deloney",
        "y": 12.0
    },
    {
        "x": "Rick Meewes",
        "y": 8.7
    },
    {
        "x": "Rob Oliver",
        "y": 19.0
    },
    {
        "x": "Robert Hill",
        "y": 22.8
    },
    {
        "x": "Ron Amstutz",
        "y": 13.8
    },
    {
        "x": "Ron Marino",
        "y": 8.8
    },
    {
        "x": "Scott Benton",
        "y": 13.8
    },
    {
        "x": "Scott Bracken",
        "y": 10.0
    },
    {
        "x": "Scott Lucas",
        "y": 13.8
    },
    {
        "x": "Shane Bolosan",
        "y": 8.5
    },
    {
        "x": "Shawn Warner",
        "y": 15.9
    },
    {
        "x": "Stephen Cherepy",
        "y": 15.0
    },
    {
        "x": "Steve Mccormick",
        "y": 11.2
    },
    {
        "x": "Steve Rosenbluth",
        "y": 14.3
    },
    {
        "x": "Stewart Polakov",
        "y": 3.2
    },
    {
        "x": "Thomas Earl",
        "y": 11.4
    },
    {
        "x": "Todd Densley",
        "y": 1.1
    },
    {
        "x": "Tracy Copenhaver",
        "y": 18.5
    },
    {
        "x": "Travis Ingram",
        "y": 8.0
    },
    {
        "x": "Travis Jorgensen",
        "y": 12.3
    },
    {
        "x": "Trent Dana",
        "y": 20.3
    },
    {
        "x": "Win Doolittle",
        "y": 17.8
    },
    {
        "x": "Zach Coe",
        "y": 2.3
    },
    {
        "x": "Zach Fleishman",
        "y": 15.0
    },
    {
        "x": "Zach Mattson",
        "y": 12.3
    },
    {
        "x": "Zane Eisenbarth",
        "y": 9.6
    }
];


        let currentData = [...dataBest3];
        let currentMode = 'best3';
        let currentSort = { column: 'adjustment', dir: 'asc' };
        let minRounds = 0;

        function init() {
            setMode('best3');
        }

        function setMode(mode) {
            currentMode = mode;
            const btn3 = document.getElementById('btn-best3');
            const btn6 = document.getElementById('btn-best6');

            if (mode === 'best3') {
                btn3.className = "px-4 py-2 text-sm font-medium border rounded-l-lg active-mode transition-colors";
                btn6.className = "px-4 py-2 text-sm font-medium border rounded-r-lg inactive-mode transition-colors";
                currentData = [...dataBest3];
            } else {
                btn3.className = "px-4 py-2 text-sm font-medium border rounded-l-lg inactive-mode transition-colors";
                btn6.className = "px-4 py-2 text-sm font-medium border rounded-r-lg active-mode transition-colors";
                currentData = [...dataBest6];
            }

            applyFilters();
        }

        function calculateStats() {
            document.getElementById('totalPlayers').textContent = currentData.length;
            const avgGross = currentData.reduce((acc, curr) => acc + curr.avgGross, 0) / currentData.length;
            document.getElementById('groupAvgGross').textContent = avgGross.toFixed(1);

            // Calculate Top 3 Adjustments (Lowest negative numbers)
            // Clone and filter out 0 or positive adjustments to focus on "improvers" or just sort all
            // We'll sort all by adjustment ascending
            const sortedByAdj = [...currentData].sort((a, b) => a.adjustment - b.adjustment);

            const top1 = sortedByAdj[0];
            const top2 = sortedByAdj[1];
            const top3 = sortedByAdj[2];

            // Render Rank 1
            if (top1) {
                document.getElementById('rank1Name').textContent = top1.name;
                document.getElementById('rank1Val').textContent = top1.adjustment;
                document.getElementById('rank1Rounds').textContent = top1.rounds + " rounds";
            }

            // Render Rank 2
            if (top2) {
                document.getElementById('rank2Name').textContent = top2.name;
                document.getElementById('rank2Val').textContent = top2.adjustment;
                document.getElementById('rank2Rounds').textContent = top2.rounds + " rounds";
            }

            // Render Rank 3
            if (top3) {
                document.getElementById('rank3Name').textContent = top3.name;
                document.getElementById('rank3Val').textContent = top3.adjustment;
                document.getElementById('rank3Rounds').textContent = top3.rounds + " rounds";
            }
        }

        function renderTable(data) {
            const tbody = document.getElementById('statsTableBody');
            tbody.innerHTML = '';

            data.forEach(player => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-slate-50 transition-colors";

                // Adjustment Coloring
                let adjClass = "font-medium text-slate-400"; // Default 0
                if (player.adjustment < -1.5) adjClass = "negative-adj";
                else if (player.adjustment < 0) adjClass = "text-orange-500 font-medium";

                // Rounds Warning
                const roundsWarning = player.rounds < 3 ? `<i class="fa-solid fa-triangle-exclamation text-yellow-500 ml-1" title="Low Round Count"></i>` : '';

                tr.innerHTML = `
                    <td class="p-4 font-medium text-slate-900 border-b border-slate-100">${player.name}</td>
                    <td class="p-4 text-center border-b border-slate-100">${player.implied}</td>
                    <td class="p-4 text-center border-b border-slate-100">${player.current}</td>
                    <td class="p-4 text-center border-b border-slate-100 ${adjClass}">${player.adjustment}</td>
                    <td class="p-4 text-center border-b border-slate-100">${player.avgGross}</td>
                    <td class="p-4 text-center border-b border-slate-100">${player.avgNet}</td>
                    <td class="p-4 text-center border-b border-slate-100">${player.rounds} ${roundsWarning}</td>
                    <td class="p-4 text-slate-400 text-xs italic border-b border-slate-100">${player.notes}</td>
                `;
                tbody.appendChild(tr);
            });

            calculateStats(); // Recalculate top 3 based on current filtered view if desired, or global. Currently recalculates based on currentData (filtered)
        }

        function sortTable(column) {
            if (currentSort.column === column) {
                currentSort.dir = currentSort.dir === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.dir = column === 'name' ? 'asc' : 'asc';
            }

            document.querySelectorAll('th i').forEach(i => i.className = 'fa-solid fa-sort ml-1 text-slate-300');
            const activeHeader = document.querySelector(`th[onclick="sortTable('${column}')"] i`);
            if (activeHeader) {
                activeHeader.className = `fa-solid fa-sort-${currentSort.dir === 'asc' ? 'up' : 'down'} ml-1 text-emerald-600`;
            }

            applyFilters(); // Re-sort happens inside applyFilters
        }

        function filterRounds(min) {
            minRounds = min;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if (parseInt(btn.dataset.min) === min) {
                    btn.classList.add('bg-emerald-100', 'text-emerald-700', 'border-emerald-200');
                    btn.classList.remove('bg-slate-100');
                } else {
                    btn.classList.remove('bg-emerald-100', 'text-emerald-700', 'border-emerald-200');
                    btn.classList.add('bg-slate-100');
                }
            });
            applyFilters();
        }

        document.getElementById('searchInput').addEventListener('keyup', (e) => {
            applyFilters();
        });

        function applyFilters() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            const sourceData = currentMode === 'best3' ? dataBest3 : dataBest6;

            currentData = sourceData.filter(player => {
                const matchesSearch = player.name.toLowerCase().includes(term);
                const matchesRounds = player.rounds >= minRounds;
                return matchesSearch && matchesRounds;
            });

            // Re-apply current sort
            const col = currentSort.column;
            const dir = currentSort.dir;
            currentData.sort((a, b) => {
                let valA = a[col];
                let valB = b[col];
                if (typeof valA === 'string') {
                    valA = valA.toLowerCase();
                    valB = valB.toLowerCase();
                }
                if (valA < valB) return dir === 'asc' ? -1 : 1;
                if (valA > valB) return dir === 'asc' ? 1 : -1;
                return 0;
            });

            renderTable(currentData);
        }

        // Run
        init();

    </script>
</body>

</html>